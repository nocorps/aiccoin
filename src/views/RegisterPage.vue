<template>
  <div class="register-container">
    <h2>Register</h2>
    <form @submit.prevent="register" class="register-form">
      <div class="input-group">
        <input v-model="name" type="text" placeholder="Your Name" required class="input-field" />
      </div>

      <div class="input-group">
        <input v-model="email" type="email" placeholder="Your Email" required class="input-field" />
      </div>

      <div class="input-group">
        <input v-model="password" type="password" placeholder="Password" required class="input-field" />
      </div>

      <div class="input-group">
        <input v-model="confirmPassword" type="password" placeholder="Confirm Password" required class="input-field" />
      </div>

      <div class="input-group">
        <select v-model="country" required class="input-field">
          <option value="" disabled>Select Your Country</option>
          <option value="Afghanistan">Afghanistan ğŸ‡¦ğŸ‡«</option>
          <option value="Albania">Albania ğŸ‡¦ğŸ‡±</option>
          <option value="Algeria">Algeria ğŸ‡©ğŸ‡¿</option>
          <option value="Andorra">Andorra ğŸ‡¦ğŸ‡©</option>
          <option value="Angola">Angola ğŸ‡¦ğŸ‡´</option>
          <option value="Antigua and Barbuda">Antigua and Barbuda ğŸ‡¦ğŸ‡¬</option>
          <option value="Argentina">Argentina ğŸ‡¦ğŸ‡·</option>
          <option value="Armenia">Armenia ğŸ‡¦ğŸ‡²</option>
          <option value="Australia">Australia ğŸ‡¦ğŸ‡º</option>
          <option value="Austria">Austria ğŸ‡¦ğŸ‡¹</option>
          <option value="Azerbaijan">Azerbaijan ğŸ‡¦ğŸ‡¿</option>
          <option value="Bahamas">Bahamas ğŸ‡§ğŸ‡¸</option>
          <option value="Bahrain">Bahrain ğŸ‡§ğŸ‡­</option>
          <option value="Bangladesh">Bangladesh ğŸ‡§ğŸ‡©</option>
          <option value="Barbados">Barbados ğŸ‡§ğŸ‡§</option>
          <option value="Belarus">Belarus ğŸ‡§ğŸ‡¾</option>
          <option value="Belgium">Belgium ğŸ‡§ğŸ‡ª</option>
          <option value="Belize">Belize ğŸ‡§ğŸ‡¿</option>
          <option value="Benin">Benin ğŸ‡§ğŸ‡¯</option>
          <option value="Bhutan">Bhutan ğŸ‡§ğŸ‡¹</option>
          <option value="Bolivia">Bolivia ğŸ‡§ğŸ‡´</option>
          <option value="Bosnia and Herzegovina">Bosnia and Herzegovina ğŸ‡§ğŸ‡¦</option>
          <option value="Botswana">Botswana ğŸ‡§ğŸ‡¼</option>
          <option value="Brazil">Brazil ğŸ‡§ğŸ‡·</option>
          <option value="Brunei">Brunei ğŸ‡§ğŸ‡³</option>
          <option value="Bulgaria">Bulgaria ğŸ‡§ğŸ‡¬</option>
          <option value="Burkina Faso">Burkina Faso ğŸ‡§ğŸ‡«</option>
          <option value="Burundi">Burundi ğŸ‡§ğŸ‡®</option>
          <option value="Cabo Verde">Cabo Verde ğŸ‡¨ğŸ‡»</option>
          <option value="Cambodia">Cambodia ğŸ‡°ğŸ‡­</option>
          <option value="Cameroon">Cameroon ğŸ‡¨ğŸ‡²</option>
          <option value="Canada">Canada ğŸ‡¨ğŸ‡¦</option>
          <option value="Central African Republic">Central African Republic ğŸ‡¨ğŸ‡«</option>
          <option value="Chad">Chad ğŸ‡¹ğŸ‡©</option>
          <option value="Chile">Chile ğŸ‡¨ğŸ‡±</option>
          <option value="China">China ğŸ‡¨ğŸ‡³</option>
          <option value="Colombia">Colombia ğŸ‡¨ğŸ‡´</option>
          <option value="Comoros">Comoros ğŸ‡°ğŸ‡²</option>
          <option value="Congo (Congo-Brazzaville)">Congo ğŸ‡¨ğŸ‡¬</option>
          <option value="Congo (Democratic Republic)">Congo (Democratic Republic) ğŸ‡¨ğŸ‡©</option>
          <option value="Costa Rica">Costa Rica ğŸ‡¨ğŸ‡·</option>
          <option value="Croatia">Croatia ğŸ‡­ğŸ‡·</option>
          <option value="Cuba">Cuba ğŸ‡¨ğŸ‡º</option>
          <option value="Cyprus">Cyprus ğŸ‡¨ğŸ‡¾</option>
          <option value="Czech Republic (Czechia)">Czech Republic ğŸ‡¨ğŸ‡¿</option>
          <option value="Denmark">Denmark ğŸ‡©ğŸ‡°</option>
          <option value="Djibouti">Djibouti ğŸ‡©ğŸ‡¯</option>
          <option value="Dominica">Dominica ğŸ‡©ğŸ‡²</option>
          <option value="Dominican Republic">Dominican Republic ğŸ‡©ğŸ‡´</option>
          <option value="Ecuador">Ecuador ğŸ‡ªğŸ‡¨</option>
          <option value="Egypt">Egypt ğŸ‡ªğŸ‡¬</option>
          <option value="El Salvador">El Salvador ğŸ‡¸ğŸ‡»</option>
          <option value="Equatorial Guinea">Equatorial Guinea ğŸ‡¬ğŸ‡¶</option>
          <option value="Eritrea">Eritrea ğŸ‡ªğŸ‡·</option>
          <option value="Estonia">Estonia ğŸ‡ªğŸ‡ª</option>
          <option value="Eswatini">Eswatini ğŸ‡¸ğŸ‡¿</option>
          <option value="Ethiopia">Ethiopia ğŸ‡ªğŸ‡¹</option>
          <option value="Fiji">Fiji ğŸ‡«ğŸ‡¯</option>
          <option value="Finland">Finland ğŸ‡«ğŸ‡®</option>
          <option value="France">France ğŸ‡«ğŸ‡·</option>
          <option value="Gabon">Gabon ğŸ‡¬ğŸ‡¦</option>
          <option value="Gambia">Gambia ğŸ‡¬ğŸ‡²</option>
          <option value="Georgia">Georgia ğŸ‡¬ğŸ‡ª</option>
          <option value="Germany">Germany ğŸ‡©ğŸ‡ª</option>
          <option value="Ghana">Ghana ğŸ‡¬ğŸ‡­</option>
          <option value="Greece">Greece ğŸ‡¬ğŸ‡·</option>
          <option value="Grenada">Grenada ğŸ‡¬ğŸ‡©</option>
          <option value="Guatemala">Guatemala ğŸ‡¬ğŸ‡¹</option>
          <option value="Guinea">Guinea ğŸ‡¬ğŸ‡³</option>
          <option value="Guinea-Bissau">Guinea-Bissau ğŸ‡¬ğŸ‡¼</option>
          <option value="Guyana">Guyana ğŸ‡¬ğŸ‡¾</option>
          <option value="Haiti">Haiti ğŸ‡­ğŸ‡¹</option>
          <option value="Honduras">Honduras ğŸ‡­ğŸ‡³</option>
          <option value="Hungary">Hungary ğŸ‡­ğŸ‡º</option>
          <option value="Iceland">Iceland ğŸ‡®ğŸ‡¸</option>
          <option value="India">India ğŸ‡®ğŸ‡³</option>
          <option value="Indonesia">Indonesia ğŸ‡®ğŸ‡©</option>
          <option value="Iran">Iran ğŸ‡®ğŸ‡·</option>
          <option value="Iraq">Iraq ğŸ‡®ğŸ‡¶</option>
          <option value="Ireland">Ireland ğŸ‡®ğŸ‡ª</option>
          <option value="Israel">Israel ğŸ‡®ğŸ‡±</option>
          <option value="Italy">Italy ğŸ‡®ğŸ‡¹</option>
          <option value="Jamaica">Jamaica ğŸ‡¯ğŸ‡²</option>
          <option value="Japan">Japan ğŸ‡¯ğŸ‡µ</option>
          <option value="Jordan">Jordan ğŸ‡¯ğŸ‡´</option>
          <option value="Kazakhstan">Kazakhstan ğŸ‡°ğŸ‡¿</option>
          <option value="Kenya">Kenya ğŸ‡°ğŸ‡ª</option>
          <option value="Kiribati">Kiribati ğŸ‡°ğŸ‡®</option>
          <option value="Korea (North)">Korea (North) ğŸ‡°ğŸ‡µ</option>
          <option value="Korea (South)">Korea (South) ğŸ‡°ğŸ‡·</option>
          <option value="Kuwait">Kuwait ğŸ‡°ğŸ‡¼</option>
          <option value="Kyrgyzstan">Kyrgyzstan ğŸ‡°ğŸ‡¬</option>
          <option value="Laos">Laos ğŸ‡±ğŸ‡¸</option>
          <option value="Latvia">Latvia ğŸ‡±ğŸ‡»</option>
          <option value="Lebanon">Lebanon ğŸ‡±ğŸ‡§</option>
          <option value="Lesotho">Lesotho ğŸ‡±ğŸ‡¸</option>
          <option value="Liberia">Liberia ğŸ‡±ğŸ‡·</option>
          <option value="Libya">Libya ğŸ‡±ğŸ‡¾</option>
          <option value="Liechtenstein">Liechtenstein ğŸ‡±ğŸ‡®</option>
          <option value="Lithuania">Lithuania ğŸ‡±ğŸ‡¹</option>
          <option value="Luxembourg">Luxembourg ğŸ‡±ğŸ‡º</option>
          <option value="Madagascar">Madagascar ğŸ‡²ğŸ‡¬</option>
          <option value="Malawi">Malawi ğŸ‡²ğŸ‡¼</option>
          <option value="Malaysia">Malaysia ğŸ‡²ğŸ‡¾</option>
          <option value="Maldives">Maldives ğŸ‡²ğŸ‡»</option>
          <option value="Mali">Mali ğŸ‡²ğŸ‡±</option>
          <option value="Malta">Malta ğŸ‡²ğŸ‡¹</option>
          <option value="Marshall Islands">Marshall Islands ğŸ‡²ğŸ‡­</option>
          <option value="Mauritania">Mauritania ğŸ‡²ğŸ‡·</option>
          <option value="Mauritius">Mauritius ğŸ‡²ğŸ‡º</option>
          <option value="Mexico">Mexico ğŸ‡²ğŸ‡½</option>
          <option value="Micronesia">Micronesia ğŸ‡«ğŸ‡²</option>
          <option value="Moldova">Moldova ğŸ‡²ğŸ‡©</option>
          <option value="Monaco">Monaco ğŸ‡²ğŸ‡¨</option>
          <option value="Mongolia">Mongolia ğŸ‡²ğŸ‡³</option>
          <option value="Montenegro">Montenegro ğŸ‡²ğŸ‡ª</option>
          <option value="Morocco">Morocco ğŸ‡²ğŸ‡¦</option>
          <option value="Mozambique">Mozambique ğŸ‡²ğŸ‡¿</option>
          <option value="Myanmar (Burma)">Myanmar (Burma) ğŸ‡²ğŸ‡²</option>
          <option value="Namibia">Namibia ğŸ‡³ğŸ‡¦</option>
          <option value="Nauru">Nauru ğŸ‡³ğŸ‡·</option>
          <option value="Nepal">Nepal ğŸ‡³ğŸ‡µ</option>
          <option value="Netherlands">Netherlands ğŸ‡³ğŸ‡±</option>
          <option value="New Zealand">New Zealand ğŸ‡³ğŸ‡¿</option>
          <option value="Nicaragua">Nicaragua ğŸ‡³ğŸ‡®</option>
          <option value="Niger">Niger ğŸ‡³ğŸ‡ª</option>
          <option value="Nigeria">Nigeria ğŸ‡³ğŸ‡¬</option>
          <option value="North Macedonia">North Macedonia ğŸ‡²ğŸ‡°</option>
          <option value="Norway">Norway ğŸ‡³ğŸ‡´</option>
          <option value="Oman">Oman ğŸ‡´ğŸ‡²</option>
          <option value="Pakistan">Pakistan ğŸ‡µğŸ‡°</option>
          <option value="Palau">Palau ğŸ‡µğŸ‡¼</option>
          <option value="Panama">Panama ğŸ‡µğŸ‡¦</option>
          <option value="Papua New Guinea">Papua New Guinea ğŸ‡µğŸ‡¬</option>
          <option value="Paraguay">Paraguay ğŸ‡µğŸ‡¾</option>
          <option value="Peru">Peru ğŸ‡µğŸ‡ª</option>
          <option value="Philippines">Philippines ğŸ‡µğŸ‡­</option>
          <option value="Poland">Poland ğŸ‡µğŸ‡±</option>
          <option value="Portugal">Portugal ğŸ‡µğŸ‡¹</option>
          <option value="Qatar">Qatar ğŸ‡¶ğŸ‡¦</option>
          <option value="Romania">Romania ğŸ‡·ğŸ‡´</option>
          <option value="Russia">Russia ğŸ‡·ğŸ‡º</option>
          <option value="Rwanda">Rwanda ğŸ‡·ğŸ‡¼</option>
          <option value="Saint Kitts and Nevis">Saint Kitts and Nevis ğŸ‡°ğŸ‡³</option>
          <option value="Saint Lucia">Saint Lucia ğŸ‡±ğŸ‡¨</option>
          <option value="Saint Vincent and the Grenadines">Saint Vincent and the Grenadines ğŸ‡»ğŸ‡¨</option>
          <option value="Samoa">Samoa ğŸ‡¼ğŸ‡¸</option>
          <option value="San Marino">San Marino ğŸ‡¸ğŸ‡²</option>
          <option value="Sao Tome and Principe">Sao Tome and Principe ğŸ‡¸ğŸ‡¹</option>
          <option value="Saudi Arabia">Saudi Arabia ğŸ‡¸ğŸ‡¦</option>
          <option value="Senegal">Senegal ğŸ‡¸ğŸ‡³</option>
          <option value="Serbia">Serbia ğŸ‡·ğŸ‡¸</option>
          <option value="Seychelles">Seychelles ğŸ‡¸ğŸ‡¨</option>
          <option value="Sierra Leone">Sierra Leone ğŸ‡¸ğŸ‡±</option>
          <option value="Singapore">Singapore ğŸ‡¸ğŸ‡¬</option>
          <option value="Slovakia">Slovakia ğŸ‡¸ğŸ‡°</option>
          <option value="Slovenia">Slovenia ğŸ‡¸ğŸ‡®</option>
          <option value="Solomon Islands">Solomon Islands ğŸ‡¸ğŸ‡§</option>
          <option value="Somalia">Somalia ğŸ‡¸ğŸ‡´</option>
          <option value="South Africa">South Africa ğŸ‡¿ğŸ‡¦</option>
          <option value="South Sudan">South Sudan ğŸ‡¸ğŸ‡¸</option>
          <option value="Spain">Spain ğŸ‡ªğŸ‡¸</option>
          <option value="Sri Lanka">Sri Lanka ğŸ‡±ğŸ‡°</option>
          <option value="Sudan">Sudan ğŸ‡¸ğŸ‡©</option>
          <option value="Suriname">Suriname ğŸ‡¸ğŸ‡·</option>
          <option value="Sweden">Sweden ğŸ‡¸ğŸ‡ª</option>
          <option value="Switzerland">Switzerland ğŸ‡¨ğŸ‡­</option>
          <option value="Syria">Syria ğŸ‡¸ğŸ‡¾</option>
          <option value="Taiwan">Taiwan ğŸ‡¹ğŸ‡¼</option>
          <option value="Tajikistan">Tajikistan ğŸ‡¹ğŸ‡¯</option>
          <option value="Tanzania">Tanzania ğŸ‡¹ğŸ‡¿</option>
          <option value="Thailand">Thailand ğŸ‡¹ğŸ‡­</option>
          <option value="Timor-Leste">Timor-Leste ğŸ‡¹ğŸ‡±</option>
          <option value="Togo">Togo ğŸ‡¹ğŸ‡¬</option>
          <option value="Tonga">Tonga ğŸ‡¹ğŸ‡´</option>
          <option value="Trinidad and Tobago">Trinidad and Tobago ğŸ‡¹ğŸ‡¹</option>
          <option value="Tunisia">Tunisia ğŸ‡¹ğŸ‡³</option>
          <option value="Turkey">Turkey ğŸ‡¹ğŸ‡·</option>
          <option value="Turkmenistan">Turkmenistan ğŸ‡¹ğŸ‡²</option>
          <option value="Tuvalu">Tuvalu ğŸ‡¹ğŸ‡»</option>
          <option value="Uganda">Uganda ğŸ‡ºğŸ‡¬</option>
          <option value="Ukraine">Ukraine ğŸ‡ºğŸ‡¦</option>
          <option value="United Arab Emirates">United Arab Emirates ğŸ‡¦ğŸ‡ª</option>
          <option value="United Kingdom">United Kingdom ğŸ‡¬ğŸ‡§</option>
          <option value="United States of America">United States ğŸ‡ºğŸ‡¸</option>
          <option value="Uruguay">Uruguay ğŸ‡ºğŸ‡¾</option>
          <option value="Uzbekistan">Uzbekistan ğŸ‡ºğŸ‡¿</option>
          <option value="Vanuatu">Vanuatu ğŸ‡»ğŸ‡º</option>
          <option value="Vatican City">Vatican City ğŸ‡»ğŸ‡¦</option>
          <option value="Venezuela">Venezuela ğŸ‡»ğŸ‡ª</option>
          <option value="Vietnam">Vietnam ğŸ‡»ğŸ‡³</option>
          <option value="Yemen">Yemen ğŸ‡¾ğŸ‡ª</option>
          <option value="Zambia">Zambia ğŸ‡¿ğŸ‡²</option>
          <option value="Zimbabwe">Zimbabwe ğŸ‡¿ğŸ‡¼</option>

        </select>
      </div>

      <div class="input-group">
        <input v-model="referralCode" type="text" placeholder="Referral Code (Optional)" class="input-field" />
      </div>

      <div class="button-container">
        <button type="submit" class="submit-button">Register</button>
      </div>
    </form>
  </div>
</template>

<script>
import { auth, db } from '../firebase';
import { createUserWithEmailAndPassword } from 'firebase/auth';
import { createUserDocument, updateReferralSystem } from '../models/userModel';
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';

export default {
  setup() {
    const name = ref('');
    const email = ref('');
    const password = ref('');
    const confirmPassword = ref('');
    const referralCode = ref('');
    const country = ref('');
    const router = useRouter();

    // Generate Unique Referral Code
    const generateReferralCode = () => 'REF' + Math.random().toString(36).substring(2, 12).toUpperCase();

    // Auto-fill referral code from URL
    onMounted(() => {
      const urlParams = new URLSearchParams(window.location.search);
      referralCode.value = urlParams.get('ref') || '';
    });

    const register = async () => {
      if (password.value !== confirmPassword.value) {
        alert('Passwords do not match!');
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email.value, password.value);
        const userId = userCredential.user.uid;
        const newReferralCode = generateReferralCode();

        console.log("User Registered:", userId, email.value);
        console.log("Referral Code Used:", referralCode.value);


        // Store user data in Firebase
        await createUserDocument(userId, {
          name: name.value,
          email: email.value,
          country: country.value,
          referralCode: newReferralCode,
          referralUsed: referralCode.value || '',
          referredUsers: [],
          coinBalance: 0
        });

        // Handle Referral System
        if (referralCode.value) {
          console.log("Updating Referral System for", referralCode.value);
          await updateReferralSystem(referralCode.value, userId, email.value);
        }

        // Redirect after successful registration
        router.push('/');
      } catch (error) {
        alert(error.message);
      }
    };

    return { name, email, password, confirmPassword, country, referralCode, register };
  }
};
</script>

<style scoped>
.register-container {
  width: 100%;
  max-width: 600px;
  margin: 20px auto;
  /* Add margin to top */
  padding: 20px;
  background-color: #f9f9f9;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  /* align-items: center; */
  /* align-content: center; */
  text-align: center;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 24px;
  color: #333;
}

.register-form {
  display: flex;
  flex-direction: column;
  align-content: center;
  /* align-items: center; */
}

.input-group {
  margin-bottom: 15px;
}

.input-field {
  /* align-content: center; */
  align-items: center;
  width: 80%;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 14px;
  background-color: #fff;
  transition: all 0.3s ease;
}

.input-field:focus {
  border-color: #007BFF;
  outline: none;
}

select.input-field {
  height: 40px;
}

.button-container {
  text-align: center;
}

.submit-button {
  width: 80%;
  padding: 12px;
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.submit-button:hover {
  background-color: #0056b3;
}
</style>
